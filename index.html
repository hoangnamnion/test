<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Title -->
    <title>
        Photobooth Hoàng Nam
    </title>

    <!-- Meta Description for SEO -->
    <meta name="description" content="Photobooth online miễn phí, filter siêu dễ thương tại PhotoBooth Hoàng Nam. Trải nghiệm thú vị, giúp bạn khám phá bản thân & định hướng tương lai.">

    <!-- Meta Keywords -->
    <meta name="keywords" content="photobooth online, chụp ảnh online, PhotoBooth Hoàng Nam">


    <!-- Meta Author -->
    <meta name="author" content="PhotoBooth Hoàng Nam">

    <!-- Meta for Facebook Open Graph -->
    <meta property="og:title" content="Photobooth Online | PhotoBooth Hoàng Nam">
    <meta property="og:description" content="Chụp ảnh photobooth online với filter cực chất tại PhotoBooth Hoàng Nam. Trải nghiệm ngay!">
    <meta property="og:image" content="https://meobeostudio.com/icon/logo.jpg">
    <meta property="og:url" content="#">
    <meta property="og:type" content="website">

    <!-- Meta for Twitter Cards -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Photobooth Hoàng Nam">
    <meta name="twitter:description" content="Tạo ảnh photobooth online độc đáo tại PhotoBooth Hoàng Nam. Khám phá ngay!">
    <meta name="twitter:image" content="https://meobeostudio.com/icon/logo.jpg">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/icon/favicon.png" type="image/x-icon">

    <!-- Custom Stylesheets -->
    <link rel="stylesheet" href="/css/font.css">
    <link rel="stylesheet" href="/css/layout/layout.css">

    <meta name="google-adsense-account" content="ca-pub-8758740316724192">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WXTKF2F9"></script>

    <!-- Google Tag Manager -->
    <script nonce="JARdpx7J0H8D2GoVqQZrLg==">
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-WXTKF2F9');
    </script>
    <!-- End Google Tag Manager -->

    <!-- Script bảo vệ -->
    <script src="/js/protect.js"></script>

</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WXTKF2F9" height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <style>
    header {
        width: 100%;
        position: fixed;
        left: 0;
        top: 0;
        z-index: 999;
        background-color: transparent;
        padding: 10px 50px;
        display: flex;
        align-items: center;
        transition: background-color 0.3s ease-in-out;
    }

    #app-logo {
        height: 140px;
        cursor: pointer;
        transition: .3s ease-in-out;
        user-select: none;
    }

    #app-logo:hover {
        transform: scale(1.1);
    }

    /* Menu trên desktop */
    #header-button-container {
        margin-left: auto;
        display: flex;
        gap: 20px;
    }

    #header-button-container a {
        text-decoration: none;
        color: #333;
        font-size: 16px;
        font-weight: 500;
        transition: color 0.3s ease-in-out;
    }

    #header-button-container a:hover {
        text-decoration: underline;
    }

    .mobile-menu-button {
        width: 40px;
        height: 40px;
        display: none;
        margin-left: auto;
        border: none;
        cursor: pointer;
        background-color: transparent !important;
        padding: 0 !important;
    }

    .mobile-menu-button svg {
        width: 100%;
        height: 100%;
        fill: #333;
    }

    #close-menu {
        display: none;
    }

    @media (max-width: 1000px) {
        #header-button-container {
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100vh;
            background: url('/images/chill.jpg') no-repeat center center fixed;
            background-size: cover;
            padding: 20px;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
            z-index: 9999;
            gap: 20px;
        }

        #header-button-container.active {
            transform: translateX(0);
        }

        #header-button-container a {
            text-decoration: none;
            color: #fff;
            font-size: 20px;
            font-weight: 700;
            width: 100%;
        }

        .mobile-menu-button {
            display: block;
        }

        #close-menu {
            display: block;
            width: 40px;
            height: 40px;
            border: none;
            background-color: transparent;
            cursor: pointer;
            margin-left: auto;
            margin-bottom: 50px;
            padding: 0 !important;
        }

        #close-menu svg {
            fill: #fff;
            width: 100%;
            height: 100%;
        }

        header {
            padding: 5px 10px;
            transition: background-color 0.3s ease-in-out;
        }
    }

    footer {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 30px 50px;
    }

    /* Add new CSS for frame options */
    .frame-option {
        display: none;
    }

    /* Show frames based on selected layout */
    body[data-layout="1x4"] .frame-option[data-layout="1x4"] {
        display: inline-block;
    }

    body[data-layout="1x3"] .frame-option[data-layout="1x3"] {
        display: inline-block;
    }

    body[data-layout="1x2"] .frame-option[data-layout="1x2"] {
        display: inline-block;
    }

    body[data-layout="2x3"] .frame-option[data-layout="2x3"] {
        display: inline-block;
    }

    .footer-logo-container {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    #footer-logo {
        height: auto;
        width: 200px;
        object-fit: cover;
        cursor: pointer;
    }

    .footer-logo-container span {
        user-select: none;
        pointer-events: none;
        display: block;
        text-align: center;
    }

    .social-links {
        position: relative;
        display: flex;
        gap: 10px;
    }

    .social-links a {
        text-decoration: none;
    }

    .social-links a svg {
        fill: #333;
        width: 50px;
        height: 50px;
        transition: background .3s ease-in-out;
        padding: 5px;
        border-radius: 50%;
    }

    .social-links a:hover svg {
        background-color: #333;
        fill: #fff;
    }

    @media (max-width: 1000px) {
        footer {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-direction: column;
            padding: 10px;
            gap: 15px;
        }

        .footer-logo-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }
    }
</style>

<header id="header">

    <!-- Nút hamburger hiển thị trên mobile -->
    <button class="mobile-menu-button" id="mobile-menu-toggle" aria-label="Mở menu">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M4 6h16v2H4zm0 5h16v2H4zm0 5h16v2H4z"></path>
        </svg>
    </button>

    <div id="header-button-container">
        <button id="close-menu" aria-label="Close mobile menu">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3 297.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256 342.6 150.6z"/></svg>        
        </button>
        <a href="/locket">Locket</a>
        <a href="/gop-y">Góp Ý</a>
        <a href="/ung-ho">Ủng Hộ</a>
        
    </div>
    
</header>
<img src="/icon/logohn.png" alt="App logo" id="app-logo">
<script src="/js/partials/header.js"></script>

    <main>
        <link rel="stylesheet" href="/css/photobooth/4_images.css">

<meta name="robots" content="noindex">

<div class="cute-container">
  <h1 id="h1Balance" data-balance="1.000.000" style="width: 100%; text-align: center; font-size: 30px;">PhotoBooth Hoàng Nam</h1>

  <div style="position: relative; width: 100%; max-width: 600px; margin: 20px auto;">
    <video id="video" autoplay playsinline muted></video>
    <div id="countdown"></div>
    <div id="spinner"></div>
  </div>

  <div style="display: flex; gap: 15px; position: relative; margin: 10px auto; width: fit-content; flex-wrap: wrap; justify-content: center;">

    <button class="function-button" id="captureBtn">Chụp</button>

    <button class="function-button" id="uploadBtn">Upload Ảnh</button>
    <input type="file" id="uploadInput" accept="image/*" multiple>

    <button class="function-button" id="flipCamBtn">Lật Cam</button>

    <button class="function-button" id="switchCamBtn">Đổi Cam</button>
  </div>

  <div class="option-container">
    <label for="captureCount">Chọn số lượng ảnh chụp tự động:</label>
    <select id="captureCount">
      <option value="1">1</option>
      <option value="4" selected>4</option>
      <option value="6">6</option>
      <option value="8">8</option>
    </select>
  </div>
  
  <div class="option-container">
    <label for="captureTime">Chọn thời gian chụp mỗi ảnh (giây):</label>
    <select id="captureTime">

      <option value="3"selected>3</option>
      <option value="5">5</option>
      <option value="10">10</option>
      <option value="15">15</option>
    </select>
  </div>

  <div class="option-container">
    <label for="layoutType">Chọn bố cục:</label>
    <select id="layoutType">
      <option value="1x4" selected>1x4 (Dọc)</option>
      <option value="1x3">1x3 (Dọc)</option>
      <option value="1x2">1x2 (Dọc)</option>
      <option value="2x3">2x3 (Lưới)</option>
    </select>
  </div>

  <div style="margin-top: 15px;">
    <h2>Ảnh Preview:</h2>
    <p>Nhấn vào ảnh để chọn hoặc hủy chọn ảnh muốn xuất (chọn đúng Số ảnh).<br>
      Lưu ý: Ảnh được upload sẽ hiển thị chữ "UPLOAD" và ảnh đó sẽ không có video !
    </p>
    <div id="previewImages"></div>
  </div>

  <!-- Phần chọn Frame: hiển thị dãy hình ảnh -->
  <div id="frameOptionsContainer" style="margin-top: 15px;">
    <h3>Chọn Frame ( Khung )</h3>
    <div id="frameOptions">
      <!-- 1x4 Layout Frames -->
      <img src="/frame/4_images/empty.png" alt="Empty Frame" class="frame-option" data-frame-url="/frame/4_images/empty.png" data-layout="1x4" data-empty="true">
      <img src="/frame/4_images/1x4-1.png" alt="Basic 1" class="frame-option selected" data-frame-url="/frame/4_images/1x4-1.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-2.png" alt="Basic 2" class="frame-option selected" data-frame-url="/frame/4_images/1x4-2.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-3.png" alt="Basic 3" class="frame-option selected" data-frame-url="/frame/4_images/1x4-3.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-4.png" alt="Basic 4" class="frame-option selected" data-frame-url="/frame/4_images/1x4-4.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-5.png" alt="Basic 5" class="frame-option selected" data-frame-url="/frame/4_images/1x4-5.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-6.png" alt="Basic 6" class="frame-option selected" data-frame-url="/frame/4_images/1x4-6.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-7.png" alt="Basic 7" class="frame-option selected" data-frame-url="/frame/4_images/1x4-7.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-8.png" alt="Basic 8" class="frame-option selected" data-frame-url="/frame/4_images/1x4-8.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-9.png" alt="Basic 9" class="frame-option selected" data-frame-url="/frame/4_images/1x4-9.png" data-layout="1x4">
      <img src="/frame/4_images/1x4-10.png" alt="Basic 10" class="frame-option selected" data-frame-url="/frame/4_images/1x4-10.png" data-layout="1x4">
      <!-- 1x3 Layout Frames -->
      <img src="/frame/3_images/empty.png" alt="Empty Frame" class="frame-option" data-frame-url="/frame/3_images/empty.png" data-layout="1x3" data-empty="true">
      <img src="/frame/3_images/1x3-1.png" alt="Basic 1" class="frame-option" data-frame-url="/frame/3_images/1x3-1.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-2.png" alt="Basic 2" class="frame-option" data-frame-url="/frame/3_images/1x3-2.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-3.png" alt="Basic 3" class="frame-option" data-frame-url="/frame/3_images/1x3-3.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-4.png" alt="Basic 4" class="frame-option" data-frame-url="/frame/3_images/1x3-4.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-5.png" alt="Basic 5" class="frame-option" data-frame-url="/frame/3_images/1x3-5.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-6.png" alt="Basic 6" class="frame-option" data-frame-url="/frame/3_images/1x3-6.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-7.png" alt="Basic 7" class="frame-option" data-frame-url="/frame/3_images/1x3-7.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-8.png" alt="Basic 8" class="frame-option" data-frame-url="/frame/3_images/1x3-8.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-9.png" alt="Basic 9" class="frame-option" data-frame-url="/frame/3_images/1x3-9.png" data-layout="1x3">
      <img src="/frame/3_images/1x3-10.png" alt="Basic 10" class="frame-option" data-frame-url="/frame/3_images/1x3-10.png" data-layout="1x3">
      <!-- 1x2 Layout Frames -->
      <img src="/frame/2_images/empty.png" alt="Empty Frame" class="frame-option" data-frame-url="/frame/2_images/empty.png" data-layout="1x2" data-empty="true">
      <img src="/frame/2_images/1x2-1.png" alt="Basic 1" class="frame-option" data-frame-url="/frame/2_images/1x2-1.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-2.png" alt="Basic 2" class="frame-option" data-frame-url="/frame/2_images/1x2-2.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-3.png" alt="Basic 3" class="frame-option" data-frame-url="/frame/2_images/1x2-3.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-4.png" alt="Basic 4" class="frame-option" data-frame-url="/frame/2_images/1x2-4.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-5.png" alt="Basic 5" class="frame-option" data-frame-url="/frame/2_images/1x2-5.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-6.png" alt="Basic 6" class="frame-option" data-frame-url="/frame/2_images/1x2-6.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-7.png" alt="Basic 7" class="frame-option" data-frame-url="/frame/2_images/1x2-7.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-8.png" alt="Basic 8" class="frame-option" data-frame-url="/frame/2_images/1x2-8.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-9.png" alt="Basic 9" class="frame-option" data-frame-url="/frame/2_images/1x2-9.png" data-layout="1x2">
      <img src="/frame/2_images/1x2-10.png" alt="Basic 10" class="frame-option" data-frame-url="/frame/2_images/1x2-10.png" data-layout="1x2">

      <!-- 2x3 Layout Frames -->
      <img src="/frame/2x3_images/empty.png" alt="Empty Frame" class="frame-option" data-frame-url="/frame/2x3_images/empty.png" data-layout="2x3" data-empty="true">
      <img src="/frame/2x3_images/2x3-1.png" alt="Basic 1" class="frame-option" data-frame-url="/frame/2x3_images/2x3-1.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-2.png" alt="Basic 2" class="frame-option" data-frame-url="/frame/2x3_images/2x3-2.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-3.png" alt="Basic 3" class="frame-option" data-frame-url="/frame/2x3_images/2x3-3.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-4.png" alt="Basic 4" class="frame-option" data-frame-url="/frame/2x3_images/2x3-4.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-5.png" alt="Basic 5" class="frame-option" data-frame-url="/frame/2x3_images/2x3-5.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-6.png" alt="Basic 6" class="frame-option" data-frame-url="/frame/2x3_images/2x3-6.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-7.png" alt="Basic 7" class="frame-option" data-frame-url="/frame/2x3_images/2x3-7.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-8.png" alt="Basic 8" class="frame-option" data-frame-url="/frame/2x3_images/2x3-8.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-9.png" alt="Basic 9" class="frame-option" data-frame-url="/frame/2x3_images/2x3-9.png" data-layout="2x3">
      <img src="/frame/2x3_images/2x3-10.png" alt="Basic 10" class="frame-option" data-frame-url="/frame/2x3_images/2x3-10.png" data-layout="2x3">
    </div>
  </div>

  <!-- Phần chọn Sticker -->
  <div id="stickerOptionsContainer" style="margin-top: 15px;">
    <h3>Chọn Sticker</h3>
    <div id="stickerOptions">
      <!-- Stickers will be loaded here -->
    </div>
  </div>

  <!-- Khu vực xem trước kết quả ghép -->
  <div id="templatePreviewContainer">
    <h2 style="font-size: 25px; width: 100%; text-align: center;">Xem trước kết quả</h2>
    <canvas id="templatePreview" style="border: none;"></canvas>
  </div>

  <div style="width: fit-content; margin: 10px auto; display: flex; gap: 15px;">
    <button class="function-button" id="exportBtn">Xuất ảnh</button>
    <button class="function-button" id="exportVideoBtn">Xuất Video </button>
  </div>

  <audio id="captureSound" src="/audio/capture_sound.mp3"></audio>

  <!-- Modal xuất video -->
  <div id="videoExportModal" class="modal">
    <div class="modal-content">
      <h2>Xuất video</h2>
      <p id="modalMessage">
        Xuất video Free<br>
        <strong>Lưu ý:</strong>  Về sau sẽ thu phí <u>2000đ/1 video</u>.<br>
        Số dư hiện tại: <span id="currentBalance"></span> đồng.
        <br>Hiện Tải Khung 2x3 xuất video đang lỗi định dạng hiện đang tìm cách khắc phục, Xin cảm ơn!!!
      </p>
      <div id="exportTimeEstimate" style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; text-align: center;">
        <p style="margin: 0; font-size: 14px;">
          <span id="estimatedTime">Đang tính toán thời gian dự kiến...</span>
        </p>
      </div>
      
      <!-- Progress section (hidden by default) -->
      <div id="exportProgress" style="display: none; margin: 15px 0;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span id="progressStatus">Đang tải xuống...</span>
          <span id="progressTime">0:00 / 0:00</span>
        </div>
        <div style="width: 100%; height: 10px; background: #f0f0f0; border-radius: 5px; overflow: hidden;">
          <div id="progressBar" style="width: 0%; height: 100%; background: #4CAF50; transition: width 0.3s ease;"></div>
        </div>
      </div>

      <!-- Video preview after export -->
      <div id="videoPreview" style="display: none; margin: 15px 0;">
        <video id="exportedVideo" controls playsinline style="width: 100%; max-width: 100%;">
          Your browser does not support the video tag.
        </video>
        <div style="margin-top: 10px; text-align: center;">
          <a id="downloadLink" href="#" download="photobooth_video.mp4" style="display: inline-block; padding: 10px 20px; background: #4CAF50; color: white; text-decoration: none; border-radius: 5px;">
            Tải video về máy
          </a>
          <p style="font-size: 12px; color: #666; margin-top: 5px;">
            Lưu ý: Video đã được tối ưu cho điện thoại
          </p>
        </div>
      </div>

      <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; width: 100%; margin-top: 15px;">
        <button class="function-button" id="youtubeSignupBtn">Đăng ký Tiktok để nhận 10k</button>
        <button class="function-button" id="hihiBtn">Xin Admin :>>></button>
        <button class="function-button" id="rechargeBtn">Nạp thêm</button>
        <button class="function-button" id="confirmExportBtn">Đồng ý xuất</button>
        <button class="function-button" id="cancelExportBtn">Từ chối xuất</button>
      </div>
    </div>
  </div>
</div>

<script src="/js/photobooth/4_images.js"></script>
    </main>

<footer>
    <div class="footer-logo-container">
        <img alt="Footer logo" src="/icon/logohn.png" id="footer-logo" aria-label="Go to Homepage" width="200" height="66.03">
        <span>Copyright © 2025 Photobooth Hoàng Nam. All rights reserved.</span>
    </div>
    <div class="social-links">
        <a href="https://www.facebook.com/meobeostudiofanpage" target="_blank" aria-label="Facebook Fanpage">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13.397 20.997v-8.196h2.765l.411-3.209h-3.176V7.548c0-.926.258-1.56 1.587-1.56h1.684V3.127A22.336 22.336 0 0 0 14.201 3c-2.444 0-4.122 1.492-4.122 4.231v2.355H7.332v3.209h2.753v8.202h3.312z"></path></svg>
        </a>
        <a href="https://www.facebook.com/groups/meobeostudio" target="_blank" aria-label="Facebook Group">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M9.5 12c2.206 0 4-1.794 4-4s-1.794-4-4-4-4 1.794-4 4 1.794 4 4 4zm1.5 1H8c-3.309 0-6 2.691-6 6v1h15v-1c0-3.309-2.691-6-6-6z"></path><path d="M16.604 11.048a5.67 5.67 0 0 0 .751-3.44c-.179-1.784-1.175-3.361-2.803-4.44l-1.105 1.666c1.119.742 1.8 1.799 1.918 2.974a3.693 3.693 0 0 1-1.072 2.986l-1.192 1.192 1.618.475C18.951 13.701 19 17.957 19 18h2c0-1.789-.956-5.285-4.396-6.952z"></path></svg>
        </a>
        <a href="https://www.tiktok.com/@meobeocutevcl" aria-label="TikTok Channel">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"></path></svg>
        </a>
    </div>
</footer>

<script src="/js/partials/footer.js"></script>
</body>

<script src="/js/layout.js"></script>

<script>
    // Add event listener for layout change
    document.getElementById('layoutType').addEventListener('change', function(e) {
        // Update body data-layout attribute
        document.body.setAttribute('data-layout', e.target.value);
        
        // Update selected frame
        const frameOptions = document.querySelectorAll('.frame-option');
        frameOptions.forEach(frame => {
            if (frame.dataset.layout === e.target.value) {
                frame.classList.add('selected');
            } else {
                frame.classList.remove('selected');
            }
        });
    });

    // Function to calculate estimated export time
    function calculateExportTime() {
        const captureCount = parseInt(document.getElementById('captureCount').value);
        const captureTime = parseInt(document.getElementById('captureTime').value);
        const layoutType = document.getElementById('layoutType').value;
        
        // Base processing time per image (in seconds)
        const baseProcessingTime = 2;
        
        // Calculate total time
        let totalTime = (captureCount * captureTime) + (captureCount * baseProcessingTime);
        
        // Add extra time based on layout complexity
        if (layoutType === '2x3') {
            totalTime *= 1.5; // More complex layout takes 50% longer
        }
        
        // Convert to minutes and seconds
        const minutes = Math.floor(totalTime / 60);
        const seconds = Math.round(totalTime % 60);
        
        return { minutes, seconds };
    }

    // Function to handle video export completion
    function handleVideoExportComplete(videoUrl) {
        // Hide progress section
        document.getElementById('exportProgress').style.display = 'none';
        
        // Show video preview
        const videoPreview = document.getElementById('videoPreview');
        videoPreview.style.display = 'block';
        
        // Set video source with proper MIME type
        const video = document.getElementById('exportedVideo');
        video.src = videoUrl;
        video.type = 'video/mp4';
        
        // Set download link with proper filename and MIME type
        const downloadLink = document.getElementById('downloadLink');
        downloadLink.href = videoUrl;
        downloadLink.download = 'photobooth_video.mp4';
        downloadLink.type = 'video/mp4';
        
        // Hide export buttons
        document.getElementById('confirmExportBtn').style.display = 'none';
        document.getElementById('cancelExportBtn').style.display = 'none';
        
        // Play video automatically on mobile
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            video.play().catch(error => {
                console.log('Autoplay failed:', error);
            });
        }

        // Add event listener for video error
        video.addEventListener('error', function(e) {
            console.error('Video error:', e);
            alert('Có lỗi xảy ra khi phát video. Vui lòng thử lại hoặc tải video về máy.');
        });
    }

    // Function to check if video is playable
    function isVideoPlayable(videoUrl) {
        return new Promise((resolve, reject) => {
            const video = document.createElement('video');
            video.src = videoUrl;
            video.type = 'video/mp4';
            
            video.addEventListener('loadedmetadata', () => {
                resolve(true);
            });
            
            video.addEventListener('error', () => {
                resolve(false);
            });
        });
    }

    // Update the export completion handler
    document.getElementById('confirmExportBtn').addEventListener('click', async function() {
        const exportProgress = document.getElementById('exportProgress');
        exportProgress.style.display = 'block';
        
        // Simulate download progress (replace with actual download logic)
        const totalTime = 30;
        let elapsedTime = 0;
        let progress = 0;
        let isDownloadComplete = false;
        
        const progressInterval = setInterval(async () => {
            if (!isDownloadComplete) {
                elapsedTime++;
                progress = (elapsedTime / totalTime) * 100;
                
                if (progress >= 100) {
                    progress = 100;
                    isDownloadComplete = true;
                    clearInterval(progressInterval);
                    
                    // Simulate video URL (replace with actual video URL)
                    const videoUrl = 'path/to/exported/video.mp4';
                    
                    // Check if video is playable
                    const isPlayable = await isVideoPlayable(videoUrl);
                    if (isPlayable) {
                        handleVideoExportComplete(videoUrl);
                    } else {
                        alert('Video không thể phát được. Vui lòng thử lại.');
                    }
                }
                
                updateProgress(progress, elapsedTime, totalTime);
            }
        }, 1000);
    });

    // Function to format time (MM:SS)
    function formatTime(seconds) {
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = Math.floor(seconds % 60);
        return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    // Function to update progress
    function updateProgress(progress, elapsedTime, totalTime) {
        const progressBar = document.getElementById('progressBar');
        const progressTime = document.getElementById('progressTime');
        const progressStatus = document.getElementById('progressStatus');
        
        // Update progress bar
        progressBar.style.width = `${progress}%`;
        
        // Update time display
        progressTime.textContent = `${formatTime(elapsedTime)} / ${formatTime(totalTime)}`;
        
        // Update status
        if (progress < 100) {
            progressStatus.textContent = 'Đang tải xuống...';
        } else {
            progressStatus.textContent = 'Tải xuống hoàn tất!';
        }
    }

    // Update estimated time when modal is shown
    document.getElementById('exportVideoBtn').addEventListener('click', function() {
        const { minutes, seconds } = calculateExportTime();
        const timeText = minutes > 0 
            ? `Thời gian dự kiến: ${minutes} phút ${seconds} giây`
            : `Thời gian dự kiến: ${seconds} giây`;
        document.getElementById('estimatedTime').textContent = timeText;
    });

    // Update estimated time when settings change
    document.getElementById('captureCount').addEventListener('change', function() {
        if (document.getElementById('videoExportModal').style.display === 'block') {
            const { minutes, seconds } = calculateExportTime();
            const timeText = minutes > 0 
                ? `Thời gian dự kiến: ${minutes} phút ${seconds} giây`
                : `Thời gian dự kiến: ${seconds} giây`;
            document.getElementById('estimatedTime').textContent = timeText;
        }
    });

    document.getElementById('captureTime').addEventListener('change', function() {
        if (document.getElementById('videoExportModal').style.display === 'block') {
            const { minutes, seconds } = calculateExportTime();
            const timeText = minutes > 0 
                ? `Thời gian dự kiến: ${minutes} phút ${seconds} giây`
                : `Thời gian dự kiến: ${seconds} giây`;
            document.getElementById('estimatedTime').textContent = timeText;
        }
    });

    document.getElementById('layoutType').addEventListener('change', function() {
        if (document.getElementById('videoExportModal').style.display === 'block') {
            const { minutes, seconds } = calculateExportTime();
            const timeText = minutes > 0 
                ? `Thời gian dự kiến: ${minutes} phút ${seconds} giây`
                : `Thời gian dự kiến: ${seconds} giây`;
            document.getElementById('estimatedTime').textContent = timeText;
        }
    });

    // Đặt data-layout cho body và hiển thị frame đúng ngay khi load trang
    window.addEventListener('DOMContentLoaded', function() {
        const layoutType = document.getElementById('layoutType').value;
        document.body.setAttribute('data-layout', layoutType);

        // Đảm bảo frame-option selected đúng với layout mặc định
        const frameOptions = document.querySelectorAll('.frame-option');
        frameOptions.forEach(frame => {
            if (frame.dataset.layout === layoutType) {
                frame.classList.add('selected');
            } else {
                frame.classList.remove('selected');
            }
        });
    });
</script>

</html>